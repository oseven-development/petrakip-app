# Documentation Amplify Backend

### Used Amplify APIS

- [Authentication](https://docs.amplify.aws/lib/auth/getting-started/q/platform/js) for user management
- [API Grahpql](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js) (Appsync) as database provider and api, uses DynamoDB and Appsync
- [DataStore](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js) as storage solution to save images and videos.

## Getting Started with Amplify CLI

This directory was generated by [Amplify CLI](https://docs.amplify.aws/cli).

Helpful resources:

- Amplify documentation: https://docs.amplify.aws
- Amplify CLI documentation: https://docs.amplify.aws/cli
- More details on this folder & generated files: https://docs.amplify.aws/cli/reference/files
- Join Amplify's community: https://amplify.aws/community/

## Setup backend

1. init profile

```bash
amplify init
```

2. amplify pull/create `aws-exports.js`

```bash
amplify env pull
```

3. push new aws services

```bash
amplify push
```

4. build application and publishes it to s3

```bash
amplify publish
```

5. generate code for frontend
   Generates GraphQL statements(queries, mutations and eventHandlers) and type annotations.

```bash
amplify codegen
```

# Data model and API structure

Petrakip needs logical objects that complex data, such as images or videos, as part of their structure. For example, a Moment type can contain a picture. With AWS AppSync, we can model these as GraphQL types, referred to as complex objects. If any of the mutations have a variable with bucket, key, region, mimeType and localUri fields, the SDK uploads the file to Amazon S3 for you.

- [reference example](https://github.com/aws-samples/aws-amplify-graphql/blob/master/schema.graphql)
- [data model as code](./backend/api/petrakipApi4data/schema.grahpql)
- [many to many](https://docs.amplify.aws/lib/datastore/relational/q/platform/js#many-to-many)
- [union types are not supported](https://github.com/aws-amplify/amplify-cli/issues/6537)

**Architecture**

![backend diagram](../docs/assets/backend_diagram.png)

## Update schema

You can compile the backend/api/~apiname~/schema.graphql by running:

```bash
amplify api gql-compile
```

and view the compiled schema output in [amplify/backend/api/petrakipApi4data/build/schema.graphql](./backend/api/petrakipApi4data/build/schema.graphql).
